# Simple Threaded HTTP Server

Учебная реализация простого HTTP-сервера на Python с использованием сокетов и пула потоков.
Сервер обслуживает **GET/HEAD** запросы и отдаёт статические файлы из заданной директории.

Реализация ориентирована на простоту, читаемость и корректность, без использования `http.server` и сторонних HTTP-библиотек.

---

## Возможности

* Методы: `GET`, `HEAD`
* Статические файлы из `DOCUMENT_ROOT`
* Корректные HTTP-коды:

  * `200 OK`
  * `403 Forbidden`
  * `404 Not Found`
  * `405 Method Not Allowed`
  * `400 Bad Request`
* Защита от path traversal (`..`)
* Многопоточность (thread pool)
* Корректное закрытие соединений
* Работа под нагрузкой (`ab`, `wrk`)

---

## Архитектура

Сервер построен вокруг простой pipeline-модели:

```
socket → Engine → HTTP parsing → FileHandler → Response → socket
```

### Основные компоненты

* **ThreadedHTTPServer**

  * Принимает соединения
  * Передаёт их в пул потоков

* **WorkerPool**

  * Обрабатывает соединения в фиксированном количестве потоков
  * Для каждого соединения вызывает `engine.handle_connection(conn)`

* **Engine**

  * Базовый класс
  * Управляет жизненным циклом соединения
  * Гарантированно закрывает сокет

* **HTTPEngine**

  * Читает HTTP-запрос
  * Парсит request line и заголовки
  * Делегирует обработку файлов `FileHandler`
  * Формирует и отправляет HTTP-ответ

* **FileHandler**

  * Работает с файловой системой
  * Резолвит пути
  * Возвращает `ResponseSpec` с `body_path` и `body_size`

* **ResponseSpec**

  * Описывает HTTP-ответ (status, headers, путь к файлу)

---

## Установка и запуск

### Требования

* Python **3.10+**
* Linux (используются стандартные сокеты)

### Запуск

```bash
python httpd.py --host 0.0.0.0 --port 8080 --root ./test --workers 8 --debug
```

### Параметры

| Параметр    | Описание                       |
| ----------- | ------------------------------ |
| `--host`    | Адрес для bind                 |
| `--port`    | Порт                           |
| `--root`    | Корневая директория для файлов |
| `--workers` | Количество потоков             |
| `--debug`   | Включить debug-вывод           |

---

## Тестирование нагрузки

Пример теста с ApacheBench:

```bash
ab -n 50000 -c 100 http://localhost:80/
```

Пример результата:

* ~5000 requests/sec
* ~20 ms mean latency
* стабильное поведение под нагрузкой
